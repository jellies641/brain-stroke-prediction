[providers]
python = "3.10"

[variables]
NIXPACKS_PYTHON_VERSION = "3.10"
PYTHONPATH = "/app/backend:/app/ml-model"
FLASK_ENV = "production"
FORCE_SQLITE = "true"

[phases.setup]
nixPkgs = ["python310", "pip", "nodejs", "npm"]

[phases.install]
cmds = [
    "pip install -r requirements.txt"
]

[phases.build]
cmds = [
    "echo 'ğŸ“¦ Building React frontend...'",
    "cd frontend",
    "npm install",
    "npm run build",
    "cd ..",
    "echo 'ğŸ“ Setting up Flask static files...'",
    "mkdir -p backend/static",
    "cp -r frontend/build/* backend/static/",
    "echo 'âœ… Frontend built and copied to backend/static'",
    "ls -la backend/static/"
]

[start]
cmd = "python start.py"
